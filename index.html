<!DOCTYPE html>
<html lang="es">
 <head>
  <meta charset="utf-8"/>
  <title>
   ServiComp ‚Äì Cotizaci√≥n Personalizada
  </title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    thead {
      background-color: #2d6cdf;
      color: white;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
    }
    tbody tr:nth-child(even) {
      background-color: #f0f4fa;
    }
    a {
      color: #1a73e8;
      text-decoration: none;
      font-weight: 600;
    }
    .loading {
      text-align: center;
      font-size: 1.2em;
      margin-top: 40px;
    }
  </style>
 </head>
 <body>
  <h1>
   ServiComp ‚Äì Cotizaci√≥n Personalizada
  </h1>
  <div id="info-cliente" style="margin-top: 10px; font-size: 15px; font-weight: 500; color: #1a237e; text-align: center;">
   <span id="cliente-texto">
    üíº Cliente:
    <strong>
     ...
    </strong>
   </span>
   <span id="dolar-texto">
    üí± D√≥lar:
    <strong>
     ...
    </strong>
   </span>
   <span id="visitante-texto">
    üëÅÔ∏è Visitante N.¬∫
    <strong>
     ...
    </strong>
   </span>
  </div>
  <div class="loading">
   Cargando productos...
  </div>
  <table style="display: none;">
   <thead>
    <tr>
     <th>
      C√≥digo
     </th>
     <th>
      Descripci√≥n
     </th>
     <th>
      Detalles
     </th>
     <th>
      Stock
     </th>
     <th>
      Precio
     </th>
     <th>
      Foto
     </th>
    </tr>
   </thead>
   <tbody id="tabla-productos">
   </tbody>
  </table>
  <div style="margin-top: 40px; font-size: 14px; color: #444; text-align: center; max-width: 700px; margin-left: auto; margin-right: auto;">
   <p style="font-weight: bold; color: #d32f2f;">
    ‚ö†Ô∏è Condiciones de la cotizaci√≥n
   </p>
   <p>
    Vigencia: 48 horas a partir de la fecha de emisi√≥n.
   </p>
   <p>
    Los precios y el stock pueden variar sin previo aviso.
   </p>
   <p>
    No incluye flete ni costos de traslado.
   </p>
   <p>
    Garant√≠a brindada directamente por el fabricante.
   </p>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
  </script>
  <script>
   async function mostrarProductos() {
  const [filtro, productos, cotiRaw] = await Promise.all([
    cargarFiltro(),
    cargarExcel(),
    fetch("https://raw.githubusercontent.com/Digicodeperu/RED/main/coti.txt").then(r => r.text())
  ]);

  const lineas = cotiRaw.split('\n');
  const margenLinea = lineas.find(l => l.toLowerCase().startsWith("margen"));
  const envioLinea = lineas.find(l => l.toLowerCase().startsWith("envio"));
  const margen = margenLinea ? parseFloat(margenLinea.split(":")[1].trim()) : 1;
  const flete = envioLinea ? parseFloat(envioLinea.split(":")[1].trim()) : 0;

  const cuerpo = document.getElementById("tabla-productos");
  const tabla = document.querySelector("table");
  const loading = document.querySelector(".loading");

  productos
    .filter(p => filtro.includes(String(p["MINI CODIGO"]).trim()))
    .forEach(p => {
      const tr = document.createElement("tr");
      const precioUSD = Number(p["PRECIO $"] || 0);
      const precioFinal = Math.round(precioUSD * margen + flete);
      const precioFormateado = "S/. " + precioFinal.toLocaleString("es-PE");

      const cod = p["CODIGO"].toLowerCase();
      const sub1 = cod.substring(0, 2);
      let sub2 = cod.substring(2, 4);
      if (cod.includes("wd")) sub2 = "dw";
      const linkImg = `https://imagenes.deltron.com.pe/images/productos//items/large/${sub1}/${sub2}/${cod}.jpg`;

      tr.innerHTML = `
        <td>${p["MINI CODIGO"]}</td>
        <td>${p["DESCRIPCION"]}</td>
        <td>${p["DETALLES"]}</td>
        <td>${p["STOCK"]}</td>
        <td>${precioFormateado}</td>
        <td><a href="${linkImg}" target="_blank">Ver FOTO</a></td>
      `;
      cuerpo.appendChild(tr);
    });

  tabla.style.display = "table";
  loading.style.display = "none";
}
  </script>
  <div id="login" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:Arial,sans-serif;">
   <h2>
    Acceso restringido
   </h2>
   <input id="claveInput" placeholder="Ingrese clave" style="padding:10px;font-size:16px;border:1px solid #ccc;border-radius:4px;"/>
   <button onclick="verificarClave()" style="margin-top:10px;padding:10px 20px;font-size:16px;">
    Entrar
   </button>
   <p id="errorClave" style="color:red;margin-top:10px;">
   </p>
  </div>
  <script>
   async function verificarClave() {
    const claveIngresada = document.getElementById("claveInput").value.trim();
    const respuesta = await fetch('https://raw.githubusercontent.com/Digicodeperu/RED/main/filtro.txt');
    const texto = await respuesta.text();
    const claves = texto.trim().split('\n');
    const claveCorrecta = claves[0].trim();
    if (claveIngresada === claveCorrecta) {
      document.getElementById("login").style.display = "none";
    } else {
      document.getElementById("errorClave").innerText = "Clave incorrecta.";
    }
  }
  </script>
  <script>
   const curiosidades = [
    { texto: "La primera programadora de la historia fue Ada Lovelace en 1843.", autor: "Ada Lovelace" },
    { texto: "El primer virus inform√°tico fue creado en 1986 y se llamaba Brain.", autor: "Basit & Amjad Farooq Alvi" },
    { texto: "La contrase√±a m√°s usada del mundo sigue siendo 123456.", autor: "NordPass Study" },
    { texto: "El primer mouse fue construido en madera en 1964.", autor: "Douglas Engelbart" },
    { texto: "El lenguaje Python fue nombrado por el grupo de comedia Monty Python.", autor: "Guido van Rossum" }
  ];

  function mostrarCuriosidad() {
    const item = curiosidades[Math.floor(Math.random() * curiosidades.length)];
    document.getElementById("sabiasque").innerHTML = `üí° <strong>¬øSab√≠as que‚Ä¶?</strong> ${item.texto}<br>‚Äî <em>${item.autor}</em>`;
  }

  window.onload = mostrarCuriosidad;
  </script>
  <script>
   async function mostrarDatosEncabezado() {
  try {
    // Obtener nombre del cliente desde coti.txt
    const resCliente = await fetch("https://raw.githubusercontent.com/Digicodeperu/RED/main/coti.txt");
    const texto = await resCliente.text();
    const lineas = texto.trim().split('\n');
    const clienteLinea = lineas.find(l => l.toLowerCase().startsWith("cliente"));
    const nombreCliente = clienteLinea ? clienteLinea.split(":")[1].trim() : "Desconocido";

    // Obtener tipo de cambio USD‚ÜíPEN
    const resDolar = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=PEN");
    const dataDolar = await resDolar.json();
    const dolar = dataDolar.rates.PEN.toFixed(2);

    // Calcular n√∫mero de visitante YYDDD
    const hoy = new Date();
    const start = new Date(hoy.getFullYear(), 0, 0);
    const diff = hoy - start;
    const day = Math.floor(diff / (1000 * 60 * 60 * 24));
    const yearShort = hoy.getFullYear().toString().slice(-2);
    const visitante = yearShort + String(day).padStart(3, '0');

    // Mostrar datos en pantalla
    document.getElementById("cliente-texto").innerHTML = `üíº Cliente: <strong>${nombreCliente}</strong>`;
    document.getElementById("dolar-texto").innerHTML = `üí± D√≥lar: <strong>S/ ${dolar}</strong>`;
    document.getElementById("visitante-texto").innerHTML = `üëÅÔ∏è Visitante N.¬∫ <strong>${visitante}</strong>`;
  } catch (err) {
    document.getElementById("info-cliente").innerText = "No se pudo cargar informaci√≥n del encabezado.";
  }
}

window.onload = mostrarDatosEncabezado;
  </script>
 </body>
</html>
