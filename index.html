
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ServiComp Online</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    thead {
      background-color: #2d6cdf;
      color: white;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
    }
    tbody tr:nth-child(even) {
      background-color: #f0f4fa;
    }
    a {
      color: #1a73e8;
      text-decoration: none;
      font-weight: 600;
    }
    .loading {
      text-align: center;
      font-size: 1.2em;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  
<h1>ServiComp Online </h1>
<p style="text-align: center; color: #d32f2f; font-weight: 600; margin-top: -10px; margin-bottom: 20px;">
  Cotización válida por 48 horas — precios y stock sujetos a modificación sin previo aviso.
</p>

  <div class="loading">Cargando productos...</div>
  <table style="display: none;">
    <thead>
      <tr>
        <th>Código</th>
        <th>Descripción</th>
        <th>Detalles</th>
        <th>Stock</th>
        <th>Precio</th>
        <th>Foto</th>
      </tr>
    </thead>
    <tbody id="tabla-productos"></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    async function cargarFiltro() {
      const res = await fetch("https://raw.githubusercontent.com/Digicodeperu/RED/main/filtro.txt");
      const txt = await res.text();
      return txt.split("\n").map(x => x.trim()).filter(x => x.length > 0);
    }

    async function cargarExcel() {
      const res = await fetch("https://raw.githubusercontent.com/Digicodeperu/RED/main/productos.xlsx");
      const data = await res.arrayBuffer();
      const workbook = XLSX.read(data, { type: "array" });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      return XLSX.utils.sheet_to_json(sheet);
    }

    function crearFila(p) {
      const tr = document.createElement("tr");
      const precio = Math.round(Number(p["PRECIO EN SOLES"] || 0));
      const img = "https://www.deltron.com.pe/modulos/productos/items/image_ext.php?item=" + p["CODIGO"];
      tr.innerHTML = `
        <td>${p["MINI CODIGO"]}</td>
        <td>${p["DESCRIPCION"]}</td>
        <td>${p["DETALLES"]}</td>
        <td>${p["STOCK"]}</td>
        <td>S/ ${precio}</td>
        <td><a href="${img}" target="_blank">Ver FOTO</a></td>
      `;
      return tr;
    }

    async function mostrarProductos() {
      const [filtro, productos] = await Promise.all([cargarFiltro(), cargarExcel()]);
      const cuerpo = document.getElementById("tabla-productos");
      const tabla = document.querySelector("table");
      const loading = document.querySelector(".loading");

      productos
        .filter(p => filtro.includes(String(p["MINI CODIGO"]).trim()))
        .forEach(p => cuerpo.appendChild(crearFila(p)));

      tabla.style.display = "table";
      loading.style.display = "none";
    }

    mostrarProductos();
  </script>
</body>
</html>
